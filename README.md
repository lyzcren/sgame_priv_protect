# 王者特权防异常 Magisk 模块

## 模块介绍

王者特权防异常模块，一目了然，是用于模拟特权的同学防异常使用。目前该模块包含功能：

- [x] 启动王者时判断当前 IP 是不是指定地区的 IP，如果 IP 不对则自动关闭王者。

  > 特权异常的根源在于模拟的地区与登录IP不同，一般出现异常的情况有：
  >
  > - 1、异地模拟忘记开代理软件或代理软件无法正常工作
  > - 2、本地模拟使用数据流量 IP 飘到其他地区（本地模拟WiFi一般IP较为稳定）
  >
  > 如果出现上述情况没有采取措施直接登入游戏到大厅，那便导致异常。在游戏开启时判断情况不对劲直接关掉游戏，再根据实际情况采取相应措施。
  >
  > 这个需求源于我刚开始模拟时，因为怕异常每次上游戏都会用浏览器查下 IP，确认IP无误再登录游戏。后来我把这个需求用 xposed edge pro 实现，教其他人时总会有各种各样的问题，由此我才打算制作这样一个 Magisk 模块。

- [x] 启动王者时自动启动代理软件

- [x] 防换号异常

  > 玩小号的同学应该知道，一旦一个号出现异常，那么接下来换号也都会连续异常。该功能可以防止换号异常

- [x] 关闭王者时自动冻结游戏

  > 对很多人来说这是个伪需求，有使用冰箱类软件的同学可以配合使用，其他同学请无视

- [x] 关闭王者时自动冻结代理软件

  > 同上

**升级 v0.8.0**之后使用默认 clnc 代理，可获取以下新特性：

- [x] 自带代理，无需找他人购买代理 IP
- [x] 防换区异常
- [x] 防断线重连异常
- [x] 防注销登录/换号异常






## 安装

下载压缩包通过 Magisk Manager 安装.



## 配置

- 1、修改模拟的地区（判断IP的地区）

  默认配置文件地区为空，此时不进行IP归属地判断，通过修改`/data/priv/config/local.config`文件内容更改地区。一般是：

  * 直辖市填写直辖市名称，如 **上海**、**北京**
  * 有县级市填写县级市名称，如 **长沙**
  * 上面2条都不是就写地级市

  > 不需要写“市”，不知道填什么的通过以下2个网站查询（代理的同学开启代理后再查询）：
  >
  >  https://ip.skk.moe/    （从国内查询（Sukka））
  >
  > https://www.speedtest.cn/tools/ip

- 2、自动启动代理软件

  > 目前支持：
  >
  > * clnc
  >
  > * Kitsunebi
  > * v2rayNG
  >
  > 有其他软件需求的，有动手能力的同学可以自己修改。

  使用MT管理器在 `/data/priv/` 路径下运行对应的 sh 文件即可。

  * clnc

  * Kitsunebi
  
  * v2rayNG
  
  * 其他（待添加）

  
  
  代理软件不支持同时开启，配置优先级： ***clnc*** > ***Kitsunebi*** > ***v2rayNG*** > ***其他***

* 3、关闭王者时自动冻结王者

  > 该功能其实就是杀后台，对于很多同学来说可能并不需要

  手动在 `/data/priv/config/` 路径下添加文件 `freeze_self` 即可。

  你也可以通过在控制台执行以下代码实现：

  ```shell
  touch /data/priv/config/freeze_self
  ```

* 4、关闭王者时自动冻结代理软件

  > 这个说白了可能也是个伪需求，跟上面一样，我的代理软件是配合王者使用，平时用不到，我甚至不想在桌面上看到图标，所以有了这个功能

  手动在 `/data/priv/config/` 路径下添加文件 `freeze_proxy_app` 即可。

  你也可以通过在控制台执行以下代码实现：

  ```shell
  touch /data/priv/config/freeze_proxy_app
  ```




## 卸载

1. 通过 Magisk Manager 卸载模块.